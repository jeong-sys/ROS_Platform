<!DOCTYPE html>
<html>
<head>
  <title>WebRTC Data Channel</title>
</head>
<body>
  <h1>WebRTC Data Channel Test</h1>
  <script>
    const signalingServerUrl = 'ws://localhost:8080';
    const peerConnectionConfig = { 'iceServers': [] };
    let localConnection, remoteConnection, sendChannel, receiveChannel;

    const signalingSocket = new WebSocket(signalingServerUrl);

    signalingSocket.onmessage = async (message) => {
      const data = JSON.parse(message.data);

      if (data.offer) {
        await remoteConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
        const answer = await remoteConnection.createAnswer();
        await remoteConnection.setLocalDescription(answer);
        signalingSocket.send(JSON.stringify({ answer }));
      } else if (data.answer) {
        await localConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
      } else if (data.candidate) {
        const candidate = new RTCIceCandidate(data.candidate);
        await localConnection.addIceCandidate(candidate);
      }
    };

    function createPeerConnection() {
      localConnection = new RTCPeerConnection(peerConnectionConfig);
      sendChannel = localConnection.createDataChannel("sendChannel");

      localConnection.onicecandidate = (event) => {
        if (event.candidate) {
          signalingSocket.send(JSON.stringify({ candidate: event.candidate }));
        }
      };

      sendChannel.onopen = () => console.log('Data channel is open');
      sendChannel.onclose = () => console.log('Data channel is closed');

      remoteConnection = new RTCPeerConnection(peerConnectionConfig);
      remoteConnection.ondatachannel = (event) => {
        receiveChannel = event.channel;
        receiveChannel.onmessage = (event) => console.log('Received message:', event.data);
      };

      remoteConnection.onicecandidate = (event) => {
        if (event.candidate) {
          signalingSocket.send(JSON.stringify({ candidate: event.candidate }));
        }
      };
    }

    async function startConnection() {
      createPeerConnection();

      const offer = await localConnection.createOffer();
      await localConnection.setLocalDescription(offer);

      signalingSocket.send(JSON.stringify({ offer: localConnection.localDescription }));
    }

    startConnection();
  </script>
</body>
</html>
